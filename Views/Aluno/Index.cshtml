@model List<AppAcademia.Models.Treino>

@{
    var concluidos = ViewBag.Concluidos as List<int> ?? new List<int>();

    int total = Model
    .SelectMany(t => t.Exercicios)
    .Count();

    int feitos = Model
    .SelectMany(t => t.Exercicios)
    .Count(e => concluidos.Contains(e.Id));
}

<h2>OlÃ¡ ðŸ‘‹</h2>
<h4>Treino de hoje</h4>

@foreach (var treino in Model)
{
    <h5 class="mt-4">@treino.DiaSemana</h5>

    @foreach (var ex in treino.Exercicios)
    {
        var feito = concluidos.Contains(ex.Id);

        <div class="card mb-3 @(feito ? "bg-success bg-opacity-25" : "")">
            <div class="card-body">
                <h5>@ex.Nome</h5>
                <p>@ex.Series x @ex.Repeticoes</p>
                <p>Descanso: @ex.Descanso s</p>

                <input type="checkbox" @(feito ? "checked disabled" : "") onchange="concluir(@ex.Id)" />
                <label>ConcluÃ­do</label>
            </div>
        </div>
    }
}

<hr />

<p><strong>@feitos</strong> de <strong>@total</strong> exercÃ­cios concluÃ­dos hoje ðŸ’ª</p>

@section Scripts {
    <script>
        function concluir(exercicioId) {
            fetch('/Aluno/ConcluirExercicio', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `exercicioId=${exercicioId}`
            }).then(() => location.reload());
        }
    </script>
}